# 実装タスクリスト

## 概要

このタスクリストは、家庭内向け生活費可視化システムのMVP実装のための段階的な実装計画です。各タスクは、要件定義書と設計書に基づいて作成されており、テスト駆動開発を意識した構成になっています。

## タスク

- [x] 1. プロジェクト構造とコア設定のセットアップ
  - Backendとフロントエンドのディレクトリ構造を作成
  - 依存関係ファイル（requirements.txt）を作成
  - 設定管理モジュール（config.py）を実装
  - _要件: 6.1, 7.5, 11.1_

- [x] 2. データベース層の実装
- [x] 2.1 データベース接続とモデル定義
  - SQLAlchemyのデータベース接続管理を実装（database.py）
  - BudgetモデルとExpenseモデルを定義
  - データベース初期化処理を実装
  - _要件: 7.1, 7.3, 7.4, 11.1_

- [x] 2.2 Pydanticスキーマの実装
  - BudgetCreate、Budget、ExpenseCreate、Expense、Summaryスキーマを実装
  - バリデーション（月形式、金額>=0）を実装
  - _要件: 1.4, 2.4_

- [x] 3. リポジトリ層の実装
- [x] 3.1 基底リポジトリの実装
  - 基底リポジトリクラスを実装（共通CRUD操作）
  - _要件: 7.5, 11.1_

- [x] 3.2 Budgetリポジトリの実装
  - 予算の作成・更新（upsert）機能を実装
  - 予算の取得（月別、ID別）機能を実装
  - 予算の削除機能を実装
  - _要件: 1.1, 1.2_

- [x] 3.3 Expenseリポジトリの実装
  - 支出の作成機能を実装（monthを自動導出）
  - 支出の取得（月別、カテゴリ別、ID別）機能を実装
  - 支出の削除機能を実装
  - _要件: 2.1, 2.2, 2.5, 2.6_

- [x] 4. サービス層の実装
- [x] 4.1 予算サービスの実装
  - 予算登録・更新ビジネスロジックを実装
  - _要件: 1.1, 1.2_

- [x] 4.2 支出サービスの実装
  - 支出登録ビジネスロジックを実装
  - Asia/Tokyoタイムゾーン処理を実装
  - _要件: 2.1, 2.2, 2.5, 2.6_

- [x] 4.3 集計サービスの実装
  - 月次集計計算ロジックを実装（予算合計、支出合計、残額）
  - 残日数計算を実装（Asia/Tokyo）
  - 1日あたり残予算計算を実装
  - 使用率計算を実装
  - 状態判定ロジックを実装（OK/WARN/DANGER）
  - _要件: 3.1, 3.2, 3.3, 3.4, 3.5, 3.6, 3.7, 4.1, 4.2, 4.3, 4.4, 4.5, 4.6_

- [x] 5. Backend APIエンドポイントの実装
- [x] 5.1 FastAPIアプリケーションのセットアップ
  - FastAPIアプリケーションを初期化（main.py）
  - CORS設定を追加
  - ロギング設定を実装
  - 例外ハンドラーを実装
  - _要件: 6.5, 6.6_

- [x] 5.2 ヘルスチェックエンドポイントの実装
  - GET /health エンドポイントを実装
  - _要件: 6.1_

- [x] 5.3 予算APIエンドポイントの実装
  - POST /api/budgets エンドポイントを実装（登録・更新）
  - GET /api/budgets エンドポイントを実装（一覧取得）
  - GET /api/budgets/{id} エンドポイントを実装（詳細取得）
  - DELETE /api/budgets/{id} エンドポイントを実装（削除）
  - _要件: 1.1, 1.2, 1.3, 6.2_

- [x] 5.4 支出APIエンドポイントの実装
  - POST /api/expenses エンドポイントを実装（登録）
  - GET /api/expenses エンドポイントを実装（一覧取得）
  - GET /api/expenses/{id} エンドポイントを実装（詳細取得）
  - DELETE /api/expenses/{id} エンドポイントを実装（削除）
  - _要件: 2.1, 2.2, 2.3, 6.3_

- [x] 5.5 集計APIエンドポイントの実装
  - GET /api/summary エンドポイントを実装（月次集計取得）
  - デフォルトで今月の集計を返す
  - _要件: 3.1, 3.2, 3.3, 3.4, 3.5, 3.6, 3.7, 6.4_

- [x] 6. Backend Dockerfileとコンテナ化
  - Backend用のDockerfileを作成
  - requirements.txtに基づいた依存関係インストールを設定
  - エントリーポイントを設定（uvicorn）
  - _要件: 8.1_

- [x] 7. Frontend UIの実装
- [x] 7.1 Streamlitアプリケーションのセットアップ
  - Streamlitアプリケーションを初期化（main.py）
  - 設定管理を実装（config.py）
  - ページナビゲーションを実装
  - _要件: 5.1, 5.2, 5.3, 5.4_

- [x] 7.2 Backend APIクライアントの実装
  - APIクライアントクラスを実装（api_client.py）
  - エラーハンドリングとリトライ機能を実装
  - _要件: 9.3, 9.6_

- [x] 7.3 ユーティリティ関数の実装
  - 数値・日付フォーマット関数を実装（formatting.py）
  - クライアント側バリデーション関数を実装（validation.py）
  - _要件: 9.3, 9.6_

- [x] 7.4 ダッシュボードページの実装
  - 集計データ取得とSummaryカードコンポーネントを実装
  - 予算合計、使用合計、残額を大きく表示
  - 残日数、1日あたり残予算を表示
  - 使用率と状態（OK/WARN/DANGER）を色分け表示
  - 30秒ごとの自動更新を実装（st.rerun()）
  - Kioskモード対応（大きいフォント、フルスクリーン）
  - _要件: 3.1, 3.2, 3.3, 3.4, 3.5, 3.6, 3.7, 4.1, 4.2, 4.3, 4.4, 4.5, 4.6, 5.1, 5.2, 5.3, 5.4_

- [x] 7.5 支出追加ページの実装
  - カテゴリ選択ドロップダウンを実装
  - 金額入力フィールドを実装
  - 日付選択フィールドを実装（デフォルト: 今日）
  - メモ入力フィールドを実装（任意）
  - 送信ボタンとバリデーションを実装
  - 成功・エラーメッセージ表示を実装
  - レスポンシブデザインを実装
  - _要件: 2.1, 2.2, 2.3, 9.1, 9.2, 9.3, 9.4, 9.8_

- [x] 7.6 予算管理ページの実装
  - 月選択フィールドを実装（YYYY-MM形式）
  - カテゴリ別予算入力フォームを実装
  - 既存予算の表示と編集機能を実装
  - 送信ボタンとバリデーションを実装
  - 成功・エラーメッセージ表示を実装
  - _要件: 1.1, 1.2, 1.3, 9.5, 9.6, 9.7_

- [x] 8. Frontend Dockerfileとコンテナ化
  - Frontend用のDockerfileを作成
  - requirements.txtに基づいた依存関係インストールを設定
  - エントリーポイントを設定（streamlit）
  - _要件: 8.1_

- [x] 9. Helmチャートの作成
- [x] 9.1 Helmチャート基本構造の作成
  - Chart.yamlを作成
  - values.yamlを作成（デフォルト値）
  - _helpers.tplを作成
  - _要件: 8.1, 8.6_

- [x] 9.2 PersistentVolumeClaimの定義
  - pvc.yamlテンプレートを作成
  - ReadWriteOnce、1Gi、local-path storageClassを設定
  - _要件: 7.1, 7.2, 8.2_

- [x] 9.3 Backend Deploymentの定義
  - backend-deployment.yamlテンプレートを作成
  - 環境変数（DATABASE_URL、TZ）を設定
  - PVCボリュームマウントを設定
  - livenessProbeとreadinessProbeを設定（/health）
  - リソース制限を設定
  - _要件: 7.1, 8.1, 8.2, 8.3, 8.4_

- [x] 9.4 Backend Serviceの定義
  - backend-service.yamlテンプレートを作成
  - ClusterIP、ポート8000を設定
  - _要件: 8.1_

- [x] 9.5 Frontend Deploymentの定義
  - frontend-deployment.yamlテンプレートを作成
  - 環境変数（BACKEND_URL、TZ）を設定
  - livenessProbeとreadinessProbeを設定（/_stcore/health）
  - リソース制限を設定
  - _要件: 8.1, 8.3, 8.4_

- [x] 9.6 Frontend Serviceの定義
  - frontend-service.yamlテンプレートを作成
  - ClusterIP、ポート8501を設定
  - _要件: 8.1_

- [x] 9.7 Ingressの定義
  - ingress.yamlテンプレートを作成
  - パスベースルーティング（/ → Frontend、/api → Backend）を設定
  - home-finance.localホスト名を設定
  - _要件: 8.5_

- [x] 10. ローカル開発環境のセットアップ
  - Docker Composeファイルを作成
  - Backend、Frontend、データボリュームを定義
  - ローカル開発用のREADMEを作成
  - _要件: 8.1_

- [x] 11. Argo CD Applicationマニフェストの作成
  - Argo CD Application YAMLを作成
  - GitOps設定（自動同期、prune、selfHeal）を設定
  - _要件: 8.6_

- [x] 12. ドキュメントの作成
  - プロジェクトREADMEを作成（概要、セットアップ、デプロイ手順）
  - Backend READMEを作成（API仕様、開発手順）
  - Frontend READMEを作成（UI仕様、開発手順）
  - Helm READMEを作成（デプロイ手順、設定値）
  - _要件: 8.1, 8.5, 8.6, 8.7_
