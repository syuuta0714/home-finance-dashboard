# 月次予算カテゴリ拡張・管理機能 - 要件定義書

## 概要

現在の家計管理アプリでは、カテゴリ数が限定的であり、固定費と変動費の区別、ライフイベント支出の管理が困難です。本機能では、実生活に即した14のカテゴリを導入し、カテゴリ管理と月次予算設定機能を実装します。

## 要件

### 要件 1: カテゴリマスタの実装

**ユーザーストーリー:** システム管理者として、カテゴリマスタを管理したい。そうすることで、ユーザーが一貫性のあるカテゴリで予算を管理できる。

#### 受け入れ基準

1. WHEN システムが起動する THEN 14個の標準カテゴリが自動登録される
2. WHEN カテゴリ一覧を取得する THEN 以下の属性を持つカテゴリが返される
   - id (string): 不変ID（英字・snake_case）
   - name (string): 表示名（日本語）
   - type (enum): fixed / variable / lifestyle / event
   - is_active (boolean): 使用中フラグ
   - note (string): 補足説明
3. WHEN カテゴリを取得する THEN 全14カテゴリが含まれる
4. WHEN カテゴリタイプでフィルタする THEN 該当するカテゴリのみが返される

### 要件 2: 月次予算の登録・編集機能

**ユーザーストーリー:** ユーザーとして、月ごとにカテゴリ別の予算を設定・編集したい。そうすることで、月ごとの支出計画を立てられる。

#### 受け入れ基準

1. WHEN 月次予算を登録する THEN 以下の情報が保存される
   - month (string): YYYY-MM形式
   - category_id (string): カテゴリID
   - amount (integer): 月額（円）
2. WHEN 同じ月・カテゴリで予算を登録する THEN 前の値が上書きされる
3. WHEN 月次予算を編集する THEN 過去月の実績データには影響しない
4. WHEN 月次予算を削除する THEN そのカテゴリの予算が0円になる
5. WHEN 金額が負数の場合 THEN バリデーションエラーが返される

### 要件 3: 初期予算データの自動登録

**ユーザーストーリー:** ユーザーとして、初回セットアップ時にデフォルト予算が自動登録されたい。そうすることで、すぐに家計管理を開始できる。

#### 受け入れ基準

1. WHEN 新規ユーザーが初回アクセスする THEN 当月の全カテゴリに対してデフォルト予算が自動登録される
2. WHEN デフォルト予算が登録される THEN 以下の金額が設定される
   - 住居: 50,656円
   - 光熱費: 17,000円
   - 通信費: 11,633円
   - 保険: 10,350円
   - 税金: 25,583円
   - 食費: 90,000円
   - 日用品: 20,000円
   - 交通費: 15,000円
   - 医療費: 3,000円
   - 娯楽・趣味: 24,000円
   - 交際費: 10,000円
   - 被服・美容: 10,000円
   - 教育: 39,000円
   - 特別支出: 0円
3. WHEN デフォルト予算が既に登録されている THEN 重複登録されない

### 要件 4: 月次予算の集計機能

**ユーザーストーリー:** ユーザーとして、月ごとの予算合計を確認したい。そうすることで、月間の支出計画全体を把握できる。

#### 受け入れ基準

1. WHEN 月次予算の合計を取得する THEN 全カテゴリの予算合計が返される
2. WHEN 予算が0円のカテゴリがある THEN 合計に含めない
3. WHEN 月次予算が存在しない THEN 合計は0円が返される
4. WHEN 複数カテゴリの予算を変更する THEN 合計が正確に更新される

### 要件 5: カテゴリ別予算の取得

**ユーザーストーリー:** ユーザーとして、カテゴリ別の予算詳細を確認したい。そうすることで、各カテゴリの予算配分を把握できる。

#### 受け入れ基準

1. WHEN 月のカテゴリ別予算を取得する THEN 以下の情報が返される
   - category_id (string): カテゴリID
   - category_name (string): カテゴリ名
   - category_type (enum): カテゴリタイプ
   - amount (integer): 予算額
2. WHEN カテゴリタイプでフィルタする THEN 該当するカテゴリの予算のみが返される
3. WHEN 予算が設定されていないカテゴリがある THEN 0円として返される

### 要件 6: 既存の支出・予算機能との互換性

**ユーザーストーリー:** システムとして、既存の支出・予算機能と新しいカテゴリ機能が共存したい。そうすることで、既存ユーザーに影響を与えない。

#### 受け入れ基準

1. WHEN 既存の支出データを取得する THEN 新しいカテゴリシステムと互換性がある
2. WHEN 既存の予算データを取得する THEN 新しいカテゴリシステムと互換性がある
3. WHEN 既存のカテゴリ（食費、日用品など）を使用する THEN 新しいカテゴリマスタにマッピングされる
4. WHEN 新しいカテゴリで支出を記録する THEN 既存の集計機能が正常に動作する
